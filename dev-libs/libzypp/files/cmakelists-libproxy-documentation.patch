index f4d9a68..15b0754 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -152,6 +152,7 @@ ELSE ( NOT UDEV_FOUND )
   ADD_DEFINITIONS(-DHAVE_UDEV)
 ENDIF ( NOT UDEV_FOUND )
 
+IF ( WITH_LIBPROXY )
 FIND_PACKAGE(libproxy)
 IF ( NOT LIBPROXY_FOUND )
   MESSAGE( STATUS " libproxy not found" )
@@ -159,13 +160,17 @@ ELSE ( NOT LIBPROXY_FOUND )
   INCLUDE_DIRECTORIES( ${LIBPROXY_INCLUDE_DIR} )
   ADD_DEFINITIONS(-D_WITH_LIBPROXY_SUPPORT_)
 ENDIF( NOT LIBPROXY_FOUND )
+ENDIF ( ENABLE_LIBPROXY )
 
+IF ( ENABLE_DOCUMENTATION )
 FIND_PROGRAM( DOXYGEN doxygen )
 IF ( NOT DOXYGEN )
   MESSAGE( FATAL_ERROR "doxygen not found: install doxygen to build the documentation." )
 ELSE ( NOT DOXYGEN )
   MESSAGE( STATUS "doxygen found: ${DOXYGEN}" )
 ENDIF ( NOT DOXYGEN )
+ENDIF ( ENABLE_DOCUMENTATION )
+
 
 MESSAGE(STATUS "soname: ${LIBZYPP_VERSION_INFO}")
 MESSAGE(STATUS "version: ${VERSION}")

